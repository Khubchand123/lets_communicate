{"ast":null,"code":"/* eslint-disable */\n\nfunction pad2(n) {\n  n |= 0;\n  return n < 10 ? `0${n}` : `${Math.min(n, 99)}`;\n}\nfunction inlineWorker() {\n  // TODO(Kagami): Cache compiled module in IndexedDB? It works in FF\n  // and Edge, see: https://github.com/mdn/webassembly-examples/issues/4\n  // Though gzipped WASM module currently weights ~70kb so it should be\n  // perfectly cached by the browser itself.\n  function fetchAndInstantiate(url, imports) {\n    if (!WebAssembly.instantiateStreaming) return fetchAndInstantiateFallback(url, imports);\n    const req = fetch(url, {\n      credentials: \"same-origin\"\n    });\n    return WebAssembly.instantiateStreaming(req, imports).catch(err => {\n      // https://github.com/Kagami/vmsg/issues/11\n      if (err.message && err.message.indexOf(\"Argument 0 must be provided and must be a Response\") > 0) {\n        return fetchAndInstantiateFallback(url, imports);\n      } else {\n        throw err;\n      }\n    });\n  }\n  function fetchAndInstantiateFallback(url, imports) {\n    return new Promise((resolve, reject) => {\n      const req = new XMLHttpRequest();\n      req.open(\"GET\", url);\n      req.responseType = \"arraybuffer\";\n      req.onload = () => {\n        resolve(WebAssembly.instantiate(req.response, imports));\n      };\n      req.onerror = reject;\n      req.send();\n    });\n  }\n\n  // Must be in sync with emcc settings!\n  const TOTAL_STACK = 5 * 1024 * 1024;\n  const TOTAL_MEMORY = 16 * 1024 * 1024;\n  const WASM_PAGE_SIZE = 64 * 1024;\n  let memory = null;\n  let dynamicTop = TOTAL_STACK;\n  // TODO(Kagami): Grow memory?\n  function sbrk(increment) {\n    const oldDynamicTop = dynamicTop;\n    dynamicTop += increment;\n    return oldDynamicTop;\n  }\n  // TODO(Kagami): LAME calls exit(-1) on internal error. Would be nice\n  // to provide custom DEBUGF/ERRORF for easier debugging. Currenty\n  // those functions do nothing.\n  function exit(status) {\n    postMessage({\n      type: \"internal-error\",\n      data: status\n    });\n  }\n  let FFI = null;\n  let ref = null;\n  let pcm_l = null;\n  function vmsg_init(rate) {\n    ref = FFI.vmsg_init(rate);\n    if (!ref) return false;\n    const pcm_l_ref = new Uint32Array(memory.buffer, ref, 1)[0];\n    pcm_l = new Float32Array(memory.buffer, pcm_l_ref);\n    return true;\n  }\n  function vmsg_encode(data) {\n    pcm_l.set(data);\n    return FFI.vmsg_encode(ref, data.length) >= 0;\n  }\n  function vmsg_flush() {\n    if (FFI.vmsg_flush(ref) < 0) return null;\n    const mp3_ref = new Uint32Array(memory.buffer, ref + 4, 1)[0];\n    const size = new Uint32Array(memory.buffer, ref + 8, 1)[0];\n    const mp3 = new Uint8Array(memory.buffer, mp3_ref, size);\n    const blob = new Blob([mp3], {\n      type: \"audio/mpeg\"\n    });\n    FFI.vmsg_free(ref);\n    ref = null;\n    pcm_l = null;\n    return blob;\n  }\n\n  // https://github.com/brion/min-wasm-fail\n  function testSafariWebAssemblyBug() {\n    const bin = new Uint8Array([0, 97, 115, 109, 1, 0, 0, 0, 1, 6, 1, 96, 1, 127, 1, 127, 3, 2, 1, 0, 5, 3, 1, 0, 1, 7, 8, 1, 4, 116, 101, 115, 116, 0, 0, 10, 16, 1, 14, 0, 32, 0, 65, 1, 54, 2, 0, 32, 0, 40, 2, 0, 11]);\n    const mod = new WebAssembly.Module(bin);\n    const inst = new WebAssembly.Instance(mod, {});\n    // test storing to and loading from a non-zero location via a parameter.\n    // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n    return inst.exports.test(4) !== 0;\n  }\n  onmessage = e => {\n    const msg = e.data;\n    switch (msg.type) {\n      case \"init\":\n        const {\n          wasmURL,\n          shimURL\n        } = msg.data;\n        Promise.resolve().then(() => {\n          if (self.WebAssembly && !testSafariWebAssemblyBug()) {\n            delete self.WebAssembly;\n          }\n          if (!self.WebAssembly) {\n            importScripts(shimURL);\n          }\n          memory = new WebAssembly.Memory({\n            initial: TOTAL_MEMORY / WASM_PAGE_SIZE,\n            maximum: TOTAL_MEMORY / WASM_PAGE_SIZE\n          });\n          return {\n            memory: memory,\n            pow: Math.pow,\n            exit: exit,\n            powf: Math.pow,\n            exp: Math.exp,\n            sqrtf: Math.sqrt,\n            cos: Math.cos,\n            log: Math.log,\n            sin: Math.sin,\n            sbrk: sbrk\n          };\n        }).then(Runtime => {\n          return fetchAndInstantiate(wasmURL, {\n            env: Runtime\n          });\n        }).then(wasm => {\n          FFI = wasm.instance.exports;\n          postMessage({\n            type: \"init\",\n            data: null\n          });\n        }).catch(err => {\n          postMessage({\n            type: \"init-error\",\n            data: err.toString()\n          });\n        });\n        break;\n      case \"start\":\n        if (!vmsg_init(msg.data)) return postMessage({\n          type: \"error\",\n          data: \"vmsg_init\"\n        });\n        break;\n      case \"data\":\n        if (!vmsg_encode(msg.data)) return postMessage({\n          type: \"error\",\n          data: \"vmsg_encode\"\n        });\n        break;\n      case \"stop\":\n        const blob = vmsg_flush();\n        if (!blob) return postMessage({\n          type: \"error\",\n          data: \"vmsg_flush\"\n        });\n        postMessage({\n          type: \"stop\",\n          data: blob\n        });\n        break;\n    }\n  };\n}\nexport class Recorder {\n  constructor() {\n    let opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let onStop = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;\n    // Can't use relative URL in blob worker, see:\n    // https://stackoverflow.com/a/22582695\n    this.wasmURL = new URL(opts.wasmURL || \"/static/js/vmsg.wasm\", location).href;\n    this.shimURL = new URL(opts.shimURL || \"/static/js/wasm-polyfill.js\", location).href;\n    this.onStop = onStop;\n    this.pitch = opts.pitch || 0;\n    this.stream = null;\n    this.audioCtx = null;\n    this.gainNode = null;\n    this.pitchFX = null;\n    this.encNode = null;\n    this.worker = null;\n    this.workerURL = null;\n    this.blob = null;\n    this.blobURL = null;\n    this.resolve = null;\n    this.reject = null;\n    Object.seal(this);\n  }\n  close() {\n    if (this.encNode) this.encNode.disconnect();\n    if (this.encNode) this.encNode.onaudioprocess = null;\n    if (this.stream) this.stopTracks();\n    if (this.audioCtx) this.audioCtx.close();\n    if (this.worker) {\n      this.worker.terminate();\n      this.worker = null;\n    }\n    if (this.workerURL) URL.revokeObjectURL(this.workerURL);\n    if (this.blobURL) URL.revokeObjectURL(this.blobURL);\n  }\n\n  // Without pitch shift:\n  //   [sourceNode] -> [gainNode] -> [encNode] -> [audioCtx.destination]\n  //                                     |\n  //                                     -> [worker]\n  // With pitch shift:\n  //   [sourceNode] -> [gainNode] -> [pitchFX] -> [encNode] -> [audioCtx.destination]\n  //                                                  |\n  //                                                  -> [worker]\n  initAudio() {\n    const getUserMedia = navigator.mediaDevices && navigator.mediaDevices.getUserMedia ? function (constraints) {\n      return navigator.mediaDevices.getUserMedia(constraints);\n    } : function (constraints) {\n      const oldGetUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n      if (!oldGetUserMedia) {\n        return Promise.reject(new Error(\"getUserMedia is not implemented in this browser\"));\n      }\n      return new Promise(function (resolve, reject) {\n        oldGetUserMedia.call(navigator, constraints, resolve, reject);\n      });\n    };\n    return getUserMedia({\n      audio: true\n    }).then(stream => {\n      this.stream = stream;\n      const audioCtx = this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();\n      const sourceNode = audioCtx.createMediaStreamSource(stream);\n      const gainNode = this.gainNode = (audioCtx.createGain || audioCtx.createGainNode).call(audioCtx);\n      gainNode.gain.value = 1;\n      sourceNode.connect(gainNode);\n      const pitchFX = this.pitchFX = new Jungle(audioCtx);\n      pitchFX.setPitchOffset(this.pitch);\n      const encNode = this.encNode = (audioCtx.createScriptProcessor || audioCtx.createJavaScriptNode).call(audioCtx, 0, 1, 1);\n      pitchFX.output.connect(encNode);\n      gainNode.connect(this.pitch === 0 ? encNode : pitchFX.input);\n    });\n  }\n  initWorker() {\n    if (this.worker) return Promise.resolve();\n    // https://stackoverflow.com/a/19201292\n    const blob = new Blob([\"(\", inlineWorker.toString(), \")()\"], {\n      type: \"application/javascript\"\n    });\n    const workerURL = this.workerURL = URL.createObjectURL(blob);\n    const worker = this.worker = new Worker(workerURL);\n    const {\n      wasmURL,\n      shimURL\n    } = this;\n    worker.postMessage({\n      type: \"init\",\n      data: {\n        wasmURL,\n        shimURL\n      }\n    });\n    return new Promise((resolve, reject) => {\n      worker.onmessage = e => {\n        const msg = e.data;\n        switch (msg.type) {\n          case \"init\":\n            resolve();\n            break;\n          case \"init-error\":\n            this.close();\n            reject(new Error(msg.data));\n            break;\n          // TODO(Kagami): Error handling.\n          case \"error\":\n          case \"internal-error\":\n            this.close();\n            console.error(\"Worker error:\", msg.data);\n            if (this.reject) this.reject(msg.data);\n            break;\n          case \"stop\":\n            this.blob = msg.data;\n            this.blobURL = URL.createObjectURL(msg.data);\n            if (this.onStop) this.onStop();\n            if (this.resolve) this.resolve(this.blob);\n            break;\n        }\n      };\n    });\n  }\n  init() {\n    return this.initAudio().then(this.initWorker.bind(this));\n  }\n  startRecording() {\n    if (!this.stream) throw new Error(\"missing audio initialization\");\n    if (!this.worker) throw new Error(\"missing worker initialization\");\n    this.blob = null;\n    if (this.blobURL) URL.revokeObjectURL(this.blobURL);\n    this.blobURL = null;\n    this.resolve = null;\n    this.reject = null;\n    this.worker.postMessage({\n      type: \"start\",\n      data: this.audioCtx.sampleRate\n    });\n    this.encNode.onaudioprocess = e => {\n      const samples = e.inputBuffer.getChannelData(0);\n      this.worker.postMessage({\n        type: \"data\",\n        data: samples\n      });\n    };\n    this.encNode.connect(this.audioCtx.destination);\n  }\n  stopRecording() {\n    if (!this.stream) throw new Error(\"missing audio initialization\");\n    if (!this.worker) throw new Error(\"missing worker initialization\");\n    this.encNode.disconnect();\n    this.encNode.onaudioprocess = null;\n    this.stopTracks();\n    this.audioCtx.close();\n    this.worker.postMessage({\n      type: \"stop\",\n      data: null\n    });\n    return new Promise((resolve, reject) => {\n      this.resolve = resolve;\n      this.reject = reject;\n    });\n  }\n  stopTracks() {\n    // Might be missed in Safari and old FF/Chrome per MDN.\n    if (this.stream.getTracks) {\n      // Hide browser's recording indicator.\n      this.stream.getTracks().forEach(track => track.stop());\n    }\n  }\n}\nexport class Form {\n  constructor() {\n    let opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    let resolve = arguments.length > 1 ? arguments[1] : undefined;\n    let reject = arguments.length > 2 ? arguments[2] : undefined;\n    this.recorder = new Recorder(opts, this.onStop.bind(this));\n    this.resolve = resolve;\n    this.reject = reject;\n    this.backdrop = null;\n    this.popup = null;\n    this.recordBtn = null;\n    this.stopBtn = null;\n    this.timer = null;\n    this.audio = null;\n    this.saveBtn = null;\n    this.tid = 0;\n    this.start = 0;\n    Object.seal(this);\n    this.recorder.initAudio().then(() => this.drawInit()).then(() => this.recorder.initWorker()).then(() => this.drawAll()).catch(err => this.drawError(err));\n  }\n  drawInit() {\n    if (this.backdrop) return;\n    const backdrop = this.backdrop = document.createElement(\"div\");\n    backdrop.className = \"vmsg-backdrop\";\n    backdrop.addEventListener(\"click\", () => this.close(null));\n    const popup = this.popup = document.createElement(\"div\");\n    popup.className = \"vmsg-popup\";\n    popup.addEventListener(\"click\", e => e.stopPropagation());\n    const progress = document.createElement(\"div\");\n    progress.className = \"vmsg-progress\";\n    for (let i = 0; i < 3; i++) {\n      const progressDot = document.createElement(\"div\");\n      progressDot.className = \"vmsg-progress-dot\";\n      progress.appendChild(progressDot);\n    }\n    popup.appendChild(progress);\n    backdrop.appendChild(popup);\n    document.body.appendChild(backdrop);\n  }\n  drawTime(msecs) {\n    const secs = Math.round(msecs / 1000);\n    this.timer.textContent = pad2(secs / 60) + \":\" + pad2(secs % 60);\n  }\n  drawAll() {\n    this.drawInit();\n    this.clearAll();\n    const recordRow = document.createElement(\"div\");\n    recordRow.className = \"vmsg-record-row\";\n    this.popup.appendChild(recordRow);\n    const recordBtn = this.recordBtn = document.createElement(\"button\");\n    recordBtn.className = \"vmsg-button vmsg-record-button\";\n    recordBtn.textContent = \"●\";\n    recordBtn.title = \"Start Recording\";\n    recordBtn.addEventListener(\"click\", () => this.startRecording());\n    recordRow.appendChild(recordBtn);\n    const stopBtn = this.stopBtn = document.createElement(\"button\");\n    stopBtn.className = \"vmsg-button vmsg-stop-button\";\n    stopBtn.style.display = \"none\";\n    stopBtn.textContent = \"■\";\n    stopBtn.title = \"Stop Recording\";\n    stopBtn.addEventListener(\"click\", () => this.stopRecording());\n    recordRow.appendChild(stopBtn);\n    const audio = this.audio = new Audio();\n    audio.autoplay = true;\n    const timer = this.timer = document.createElement(\"span\");\n    timer.className = \"vmsg-timer\";\n    timer.title = \"Preview Recording\";\n    timer.addEventListener(\"click\", () => {\n      if (audio.paused) {\n        if (this.recorder.blobURL) {\n          audio.src = this.recorder.blobURL;\n        }\n      } else {\n        audio.pause();\n      }\n    });\n    this.drawTime(0);\n    recordRow.appendChild(timer);\n    const saveBtn = this.saveBtn = document.createElement(\"button\");\n    saveBtn.className = \"vmsg-button vmsg-save-button\";\n    saveBtn.textContent = \"✓\";\n    saveBtn.title = \"Save Recording\";\n    saveBtn.disabled = true;\n    saveBtn.addEventListener(\"click\", () => this.close(this.recorder.blob));\n    recordRow.appendChild(saveBtn);\n    const gainWrapper = document.createElement(\"div\");\n    gainWrapper.className = \"vmsg-slider-wrapper vmsg-gain-slider-wrapper\";\n    const gainSlider = document.createElement(\"input\");\n    gainSlider.className = \"vmsg-slider vmsg-gain-slider\";\n    gainSlider.setAttribute(\"type\", \"range\");\n    gainSlider.min = 0;\n    gainSlider.max = 2;\n    gainSlider.step = 0.2;\n    gainSlider.value = 1;\n    gainSlider.onchange = () => {\n      const gain = +gainSlider.value;\n      this.recorder.gainNode.gain.value = gain;\n    };\n    gainWrapper.appendChild(gainSlider);\n    this.popup.appendChild(gainWrapper);\n    const pitchWrapper = document.createElement(\"div\");\n    pitchWrapper.className = \"vmsg-slider-wrapper vmsg-pitch-slider-wrapper\";\n    const pitchSlider = document.createElement(\"input\");\n    pitchSlider.className = \"vmsg-slider vmsg-pitch-slider\";\n    pitchSlider.setAttribute(\"type\", \"range\");\n    pitchSlider.min = -1;\n    pitchSlider.max = 1;\n    pitchSlider.step = 0.2;\n    pitchSlider.value = this.recorder.pitch;\n    pitchSlider.onchange = () => {\n      const pitch = +pitchSlider.value;\n      this.recorder.pitchFX.setPitchOffset(pitch);\n      this.recorder.gainNode.disconnect();\n      this.recorder.gainNode.connect(pitch === 0 ? this.recorder.encNode : this.recorder.pitchFX.input);\n    };\n    pitchWrapper.appendChild(pitchSlider);\n    this.popup.appendChild(pitchWrapper);\n    recordBtn.focus();\n  }\n  drawError(err) {\n    console.error(err);\n    this.drawInit();\n    this.clearAll();\n    const error = document.createElement(\"div\");\n    error.className = \"vmsg-error\";\n    error.textContent = err.toString();\n    this.popup.appendChild(error);\n  }\n  clearAll() {\n    if (!this.popup) return;\n    this.popup.innerHTML = \"\";\n  }\n  close(blob) {\n    if (this.audio) this.audio.pause();\n    if (this.tid) clearTimeout(this.tid);\n    this.recorder.close();\n    this.backdrop.remove();\n    if (blob) {\n      this.resolve(blob);\n    } else {\n      this.reject(new Error(\"No record made\"));\n    }\n  }\n  onStop() {\n    this.recordBtn.style.display = \"\";\n    this.stopBtn.style.display = \"none\";\n    this.stopBtn.disabled = false;\n    this.saveBtn.disabled = false;\n  }\n  startRecording() {\n    this.audio.pause();\n    this.start = Date.now();\n    this.updateTime();\n    this.recordBtn.style.display = \"none\";\n    this.stopBtn.style.display = \"\";\n    this.saveBtn.disabled = true;\n    this.stopBtn.focus();\n    this.recorder.startRecording();\n  }\n  stopRecording() {\n    clearTimeout(this.tid);\n    this.tid = 0;\n    this.stopBtn.disabled = true;\n    this.recordBtn.focus();\n    this.recorder.stopRecording();\n  }\n  updateTime() {\n    // NOTE(Kagami): We can do this in `onaudioprocess` but that would\n    // run too often and create unnecessary DOM updates.\n    this.drawTime(Date.now() - this.start);\n    this.tid = setTimeout(() => this.updateTime(), 300);\n  }\n}\nlet shown = false;\n\n/**\n * Record a new voice message.\n *\n * @param {Object=} opts - Options\n * @param {string=} opts.wasmURL - URL of the module\n *                                 (\"/static/js/vmsg.wasm\" by default)\n * @param {string=} opts.shimURL - URL of the WebAssembly polyfill\n *                                 (\"/static/js/wasm-polyfill.js\" by default)\n * @param {number=} opts.pitch - Initial pitch shift ([-1, 1], 0 by default)\n * @return {Promise.<Blob>} A promise that contains recorded blob when fulfilled.\n */\nexport function record(opts) {\n  return new Promise((resolve, reject) => {\n    if (shown) throw new Error(\"Record form is already opened\");\n    shown = true;\n    new Form(opts, resolve, reject);\n    // Use `.finally` once it's available in Safari and Edge.\n  }).then(result => {\n    shown = false;\n    return result;\n  }, err => {\n    shown = false;\n    throw err;\n  });\n}\n\n/**\n * All available public items.\n */\nexport default {\n  Recorder,\n  Form,\n  record\n};\n\n// Borrowed from and slightly modified:\n// https://github.com/cwilso/Audio-Input-Effects/blob/master/js/jungle.js\n\n// Copyright 2012, Google Inc.\n// All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//     * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//     * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//     * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nconst delayTime = 0.100;\nconst fadeTime = 0.050;\nconst bufferTime = 0.100;\nfunction createFadeBuffer(context, activeTime, fadeTime) {\n  var length1 = activeTime * context.sampleRate;\n  var length2 = (activeTime - 2 * fadeTime) * context.sampleRate;\n  var length = length1 + length2;\n  var buffer = context.createBuffer(1, length, context.sampleRate);\n  var p = buffer.getChannelData(0);\n  var fadeLength = fadeTime * context.sampleRate;\n  var fadeIndex1 = fadeLength;\n  var fadeIndex2 = length1 - fadeLength;\n\n  // 1st part of cycle\n  for (var i = 0; i < length1; ++i) {\n    var value;\n    if (i < fadeIndex1) {\n      value = Math.sqrt(i / fadeLength);\n    } else if (i >= fadeIndex2) {\n      value = Math.sqrt(1 - (i - fadeIndex2) / fadeLength);\n    } else {\n      value = 1;\n    }\n    p[i] = value;\n  }\n\n  // 2nd part\n  for (var i = length1; i < length; ++i) {\n    p[i] = 0;\n  }\n  return buffer;\n}\nfunction createDelayTimeBuffer(context, activeTime, fadeTime, shiftUp) {\n  var length1 = activeTime * context.sampleRate;\n  var length2 = (activeTime - 2 * fadeTime) * context.sampleRate;\n  var length = length1 + length2;\n  var buffer = context.createBuffer(1, length, context.sampleRate);\n  var p = buffer.getChannelData(0);\n\n  // 1st part of cycle\n  for (var i = 0; i < length1; ++i) {\n    if (shiftUp)\n      // This line does shift-up transpose\n      p[i] = (length1 - i) / length;else\n      // This line does shift-down transpose\n      p[i] = i / length1;\n  }\n\n  // 2nd part\n  for (var i = length1; i < length; ++i) {\n    p[i] = 0;\n  }\n  return buffer;\n}\nfunction Jungle(context) {\n  this.context = context;\n  // Create nodes for the input and output of this \"module\".\n  var input = (context.createGain || context.createGainNode).call(context);\n  var output = (context.createGain || context.createGainNode).call(context);\n  this.input = input;\n  this.output = output;\n\n  // Delay modulation.\n  var mod1 = context.createBufferSource();\n  var mod2 = context.createBufferSource();\n  var mod3 = context.createBufferSource();\n  var mod4 = context.createBufferSource();\n  this.shiftDownBuffer = createDelayTimeBuffer(context, bufferTime, fadeTime, false);\n  this.shiftUpBuffer = createDelayTimeBuffer(context, bufferTime, fadeTime, true);\n  mod1.buffer = this.shiftDownBuffer;\n  mod2.buffer = this.shiftDownBuffer;\n  mod3.buffer = this.shiftUpBuffer;\n  mod4.buffer = this.shiftUpBuffer;\n  mod1.loop = true;\n  mod2.loop = true;\n  mod3.loop = true;\n  mod4.loop = true;\n\n  // for switching between oct-up and oct-down\n  var mod1Gain = (context.createGain || context.createGainNode).call(context);\n  var mod2Gain = (context.createGain || context.createGainNode).call(context);\n  var mod3Gain = (context.createGain || context.createGainNode).call(context);\n  mod3Gain.gain.value = 0;\n  var mod4Gain = (context.createGain || context.createGainNode).call(context);\n  mod4Gain.gain.value = 0;\n  mod1.connect(mod1Gain);\n  mod2.connect(mod2Gain);\n  mod3.connect(mod3Gain);\n  mod4.connect(mod4Gain);\n\n  // Delay amount for changing pitch.\n  var modGain1 = (context.createGain || context.createGainNode).call(context);\n  var modGain2 = (context.createGain || context.createGainNode).call(context);\n  var delay1 = (context.createDelay || context.createDelayNode).call(context);\n  var delay2 = (context.createDelay || context.createDelayNode).call(context);\n  mod1Gain.connect(modGain1);\n  mod2Gain.connect(modGain2);\n  mod3Gain.connect(modGain1);\n  mod4Gain.connect(modGain2);\n  modGain1.connect(delay1.delayTime);\n  modGain2.connect(delay2.delayTime);\n\n  // Crossfading.\n  var fade1 = context.createBufferSource();\n  var fade2 = context.createBufferSource();\n  var fadeBuffer = createFadeBuffer(context, bufferTime, fadeTime);\n  fade1.buffer = fadeBuffer;\n  fade2.buffer = fadeBuffer;\n  fade1.loop = true;\n  fade2.loop = true;\n  var mix1 = (context.createGain || context.createGainNode).call(context);\n  var mix2 = (context.createGain || context.createGainNode).call(context);\n  mix1.gain.value = 0;\n  mix2.gain.value = 0;\n  fade1.connect(mix1.gain);\n  fade2.connect(mix2.gain);\n\n  // Connect processing graph.\n  input.connect(delay1);\n  input.connect(delay2);\n  delay1.connect(mix1);\n  delay2.connect(mix2);\n  mix1.connect(output);\n  mix2.connect(output);\n\n  // Start\n  var t = context.currentTime + 0.050;\n  var t2 = t + bufferTime - fadeTime;\n  mod1.start(t);\n  mod2.start(t2);\n  mod3.start(t);\n  mod4.start(t2);\n  fade1.start(t);\n  fade2.start(t2);\n  this.mod1 = mod1;\n  this.mod2 = mod2;\n  this.mod1Gain = mod1Gain;\n  this.mod2Gain = mod2Gain;\n  this.mod3Gain = mod3Gain;\n  this.mod4Gain = mod4Gain;\n  this.modGain1 = modGain1;\n  this.modGain2 = modGain2;\n  this.fade1 = fade1;\n  this.fade2 = fade2;\n  this.mix1 = mix1;\n  this.mix2 = mix2;\n  this.delay1 = delay1;\n  this.delay2 = delay2;\n  this.setDelay(delayTime);\n}\nJungle.prototype.setDelay = function (delayTime) {\n  this.modGain1.gain.setTargetAtTime(0.5 * delayTime, 0, 0.010);\n  this.modGain2.gain.setTargetAtTime(0.5 * delayTime, 0, 0.010);\n};\nJungle.prototype.setPitchOffset = function (mult) {\n  if (mult > 0) {\n    // pitch up\n    this.mod1Gain.gain.value = 0;\n    this.mod2Gain.gain.value = 0;\n    this.mod3Gain.gain.value = 1;\n    this.mod4Gain.gain.value = 1;\n  } else {\n    // pitch down\n    this.mod1Gain.gain.value = 1;\n    this.mod2Gain.gain.value = 1;\n    this.mod3Gain.gain.value = 0;\n    this.mod4Gain.gain.value = 0;\n  }\n  this.setDelay(delayTime * Math.abs(mult));\n};","map":{"version":3,"names":["pad2","n","Math","min","inlineWorker","fetchAndInstantiate","url","imports","WebAssembly","instantiateStreaming","fetchAndInstantiateFallback","req","fetch","credentials","catch","err","message","indexOf","Promise","resolve","reject","XMLHttpRequest","open","responseType","onload","instantiate","response","onerror","send","TOTAL_STACK","TOTAL_MEMORY","WASM_PAGE_SIZE","memory","dynamicTop","sbrk","increment","oldDynamicTop","exit","status","postMessage","type","data","FFI","ref","pcm_l","vmsg_init","rate","pcm_l_ref","Uint32Array","buffer","Float32Array","vmsg_encode","set","length","vmsg_flush","mp3_ref","size","mp3","Uint8Array","blob","Blob","vmsg_free","testSafariWebAssemblyBug","bin","mod","Module","inst","Instance","exports","test","onmessage","e","msg","wasmURL","shimURL","then","self","importScripts","Memory","initial","maximum","pow","powf","exp","sqrtf","sqrt","cos","log","sin","Runtime","env","wasm","instance","toString","Recorder","constructor","opts","arguments","undefined","onStop","URL","location","href","pitch","stream","audioCtx","gainNode","pitchFX","encNode","worker","workerURL","blobURL","Object","seal","close","disconnect","onaudioprocess","stopTracks","terminate","revokeObjectURL","initAudio","getUserMedia","navigator","mediaDevices","constraints","oldGetUserMedia","webkitGetUserMedia","mozGetUserMedia","Error","call","audio","window","AudioContext","webkitAudioContext","sourceNode","createMediaStreamSource","createGain","createGainNode","gain","value","connect","Jungle","setPitchOffset","createScriptProcessor","createJavaScriptNode","output","input","initWorker","createObjectURL","Worker","console","error","init","bind","startRecording","sampleRate","samples","inputBuffer","getChannelData","destination","stopRecording","getTracks","forEach","track","stop","Form","recorder","backdrop","popup","recordBtn","stopBtn","timer","saveBtn","tid","start","drawInit","drawAll","drawError","document","createElement","className","addEventListener","stopPropagation","progress","i","progressDot","appendChild","body","drawTime","msecs","secs","round","textContent","clearAll","recordRow","title","style","display","Audio","autoplay","paused","src","pause","disabled","gainWrapper","gainSlider","setAttribute","max","step","onchange","pitchWrapper","pitchSlider","focus","innerHTML","clearTimeout","remove","Date","now","updateTime","setTimeout","shown","record","result","delayTime","fadeTime","bufferTime","createFadeBuffer","context","activeTime","length1","length2","createBuffer","p","fadeLength","fadeIndex1","fadeIndex2","createDelayTimeBuffer","shiftUp","mod1","createBufferSource","mod2","mod3","mod4","shiftDownBuffer","shiftUpBuffer","loop","mod1Gain","mod2Gain","mod3Gain","mod4Gain","modGain1","modGain2","delay1","createDelay","createDelayNode","delay2","fade1","fade2","fadeBuffer","mix1","mix2","t","currentTime","t2","setDelay","prototype","setTargetAtTime","mult","abs"],"sources":["C:/lets_communicate/node_modules/vmsg/vmsg.js"],"sourcesContent":["/* eslint-disable */\n\nfunction pad2(n) {\n  n |= 0;\n  return n < 10 ? `0${n}` : `${Math.min(n, 99)}`;\n}\n\nfunction inlineWorker() {\n  // TODO(Kagami): Cache compiled module in IndexedDB? It works in FF\n  // and Edge, see: https://github.com/mdn/webassembly-examples/issues/4\n  // Though gzipped WASM module currently weights ~70kb so it should be\n  // perfectly cached by the browser itself.\n  function fetchAndInstantiate(url, imports) {\n    if (!WebAssembly.instantiateStreaming) return fetchAndInstantiateFallback(url, imports);\n    const req = fetch(url, {credentials: \"same-origin\"});\n    return WebAssembly.instantiateStreaming(req, imports).catch(err => {\n      // https://github.com/Kagami/vmsg/issues/11\n      if (err.message && err.message.indexOf(\"Argument 0 must be provided and must be a Response\") > 0) {\n        return fetchAndInstantiateFallback(url, imports);\n      } else {\n        throw err;\n      }\n    });\n  }\n\n  function fetchAndInstantiateFallback(url, imports) {\n    return new Promise((resolve, reject) => {\n      const req = new XMLHttpRequest();\n      req.open(\"GET\", url);\n      req.responseType = \"arraybuffer\";\n      req.onload = () => {\n        resolve(WebAssembly.instantiate(req.response, imports));\n      };\n      req.onerror = reject;\n      req.send();\n    });\n  }\n\n  // Must be in sync with emcc settings!\n  const TOTAL_STACK = 5 * 1024 * 1024;\n  const TOTAL_MEMORY = 16 * 1024 * 1024;\n  const WASM_PAGE_SIZE = 64 * 1024;\n  let memory = null;\n  let dynamicTop = TOTAL_STACK;\n  // TODO(Kagami): Grow memory?\n  function sbrk(increment) {\n    const oldDynamicTop = dynamicTop;\n    dynamicTop += increment;\n    return oldDynamicTop;\n  }\n  // TODO(Kagami): LAME calls exit(-1) on internal error. Would be nice\n  // to provide custom DEBUGF/ERRORF for easier debugging. Currenty\n  // those functions do nothing.\n  function exit(status) {\n    postMessage({type: \"internal-error\", data: status});\n  }\n\n  let FFI = null;\n  let ref = null;\n  let pcm_l = null;\n  function vmsg_init(rate) {\n    ref = FFI.vmsg_init(rate);\n    if (!ref) return false;\n    const pcm_l_ref = new Uint32Array(memory.buffer, ref, 1)[0];\n    pcm_l = new Float32Array(memory.buffer, pcm_l_ref);\n    return true;\n  }\n  function vmsg_encode(data) {\n    pcm_l.set(data);\n    return FFI.vmsg_encode(ref, data.length) >= 0;\n  }\n  function vmsg_flush() {\n    if (FFI.vmsg_flush(ref) < 0) return null;\n    const mp3_ref = new Uint32Array(memory.buffer, ref + 4, 1)[0];\n    const size = new Uint32Array(memory.buffer, ref + 8, 1)[0];\n    const mp3 = new Uint8Array(memory.buffer, mp3_ref, size);\n    const blob = new Blob([mp3], {type: \"audio/mpeg\"});\n    FFI.vmsg_free(ref);\n    ref = null;\n    pcm_l = null;\n    return blob;\n  }\n\n  // https://github.com/brion/min-wasm-fail\n  function testSafariWebAssemblyBug() {\n    const bin = new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]);\n    const mod = new WebAssembly.Module(bin);\n    const inst = new WebAssembly.Instance(mod, {});\n    // test storing to and loading from a non-zero location via a parameter.\n    // Safari on iOS 11.2.5 returns 0 unexpectedly at non-zero locations\n    return (inst.exports.test(4) !== 0);\n  }\n\n  onmessage = (e) => {\n    const msg = e.data;\n    switch (msg.type) {\n    case \"init\":\n      const { wasmURL, shimURL } = msg.data;\n      Promise.resolve().then(() => {\n        if (self.WebAssembly && !testSafariWebAssemblyBug()) {\n          delete self.WebAssembly;\n        }\n        if (!self.WebAssembly) {\n          importScripts(shimURL);\n        }\n        memory = new WebAssembly.Memory({\n          initial: TOTAL_MEMORY / WASM_PAGE_SIZE,\n          maximum: TOTAL_MEMORY / WASM_PAGE_SIZE,\n        });\n        return {\n          memory: memory,\n          pow: Math.pow,\n          exit: exit,\n          powf: Math.pow,\n          exp: Math.exp,\n          sqrtf: Math.sqrt,\n          cos: Math.cos,\n          log: Math.log,\n          sin: Math.sin,\n          sbrk: sbrk,\n        };\n      }).then(Runtime => {\n        return fetchAndInstantiate(wasmURL, {env: Runtime})\n      }).then(wasm => {\n        FFI = wasm.instance.exports;\n        postMessage({type: \"init\", data: null});\n      }).catch(err => {\n        postMessage({type: \"init-error\", data: err.toString()});\n      });\n      break;\n    case \"start\":\n      if (!vmsg_init(msg.data)) return postMessage({type: \"error\", data: \"vmsg_init\"});\n      break;\n    case \"data\":\n      if (!vmsg_encode(msg.data)) return postMessage({type: \"error\", data: \"vmsg_encode\"});\n      break;\n    case \"stop\":\n      const blob = vmsg_flush();\n      if (!blob) return postMessage({type: \"error\", data: \"vmsg_flush\"});\n      postMessage({type: \"stop\", data: blob});\n      break;\n    }\n  };\n}\n\nexport class Recorder {\n  constructor(opts = {}, onStop = null) {\n    // Can't use relative URL in blob worker, see:\n    // https://stackoverflow.com/a/22582695\n    this.wasmURL = new URL(opts.wasmURL || \"/static/js/vmsg.wasm\", location).href;\n    this.shimURL = new URL(opts.shimURL || \"/static/js/wasm-polyfill.js\", location).href;\n    this.onStop = onStop;\n    this.pitch = opts.pitch || 0;\n    this.stream = null;\n    this.audioCtx = null;\n    this.gainNode = null;\n    this.pitchFX = null;\n    this.encNode = null;\n    this.worker = null;\n    this.workerURL = null;\n    this.blob = null;\n    this.blobURL = null;\n    this.resolve = null;\n    this.reject = null;\n    Object.seal(this);\n  }\n\n  close() {\n    if (this.encNode) this.encNode.disconnect();\n    if (this.encNode) this.encNode.onaudioprocess = null;\n    if (this.stream) this.stopTracks();\n    if (this.audioCtx) this.audioCtx.close();\n    if (this.worker) {\n      this.worker.terminate();\n      this.worker = null;\n    }\n    if (this.workerURL) URL.revokeObjectURL(this.workerURL);\n    if (this.blobURL) URL.revokeObjectURL(this.blobURL);\n  }\n\n  // Without pitch shift:\n  //   [sourceNode] -> [gainNode] -> [encNode] -> [audioCtx.destination]\n  //                                     |\n  //                                     -> [worker]\n  // With pitch shift:\n  //   [sourceNode] -> [gainNode] -> [pitchFX] -> [encNode] -> [audioCtx.destination]\n  //                                                  |\n  //                                                  -> [worker]\n  initAudio() {\n    const getUserMedia = navigator.mediaDevices && navigator.mediaDevices.getUserMedia\n      ? function(constraints) {\n          return navigator.mediaDevices.getUserMedia(constraints);\n        }\n      : function(constraints) {\n          const oldGetUserMedia = navigator.webkitGetUserMedia || navigator.mozGetUserMedia;\n          if (!oldGetUserMedia) {\n            return Promise.reject(new Error(\"getUserMedia is not implemented in this browser\"));\n          }\n          return new Promise(function(resolve, reject) {\n            oldGetUserMedia.call(navigator, constraints, resolve, reject);\n          });\n        };\n\n    return getUserMedia({audio: true}).then((stream) => {\n      this.stream = stream;\n      const audioCtx = this.audioCtx = new (window.AudioContext\n        || window.webkitAudioContext)();\n\n      const sourceNode = audioCtx.createMediaStreamSource(stream);\n      const gainNode = this.gainNode = (audioCtx.createGain\n        || audioCtx.createGainNode).call(audioCtx);\n      gainNode.gain.value = 1;\n      sourceNode.connect(gainNode);\n\n      const pitchFX = this.pitchFX = new Jungle(audioCtx);\n      pitchFX.setPitchOffset(this.pitch);\n\n      const encNode = this.encNode = (audioCtx.createScriptProcessor\n        || audioCtx.createJavaScriptNode).call(audioCtx, 0, 1, 1);\n      pitchFX.output.connect(encNode);\n\n      gainNode.connect(this.pitch === 0 ? encNode : pitchFX.input);\n    });\n  }\n\n  initWorker() {\n    if (this.worker) return Promise.resolve();\n    // https://stackoverflow.com/a/19201292\n    const blob = new Blob(\n      [\"(\", inlineWorker.toString(), \")()\"],\n      {type: \"application/javascript\"});\n    const workerURL = this.workerURL = URL.createObjectURL(blob);\n    const worker = this.worker = new Worker(workerURL);\n    const { wasmURL, shimURL } = this;\n    worker.postMessage({type: \"init\", data: {wasmURL, shimURL}});\n    return new Promise((resolve, reject) => {\n      worker.onmessage = (e) => {\n        const msg = e.data;\n        switch (msg.type) {\n        case \"init\":\n          resolve();\n          break;\n        case \"init-error\":\n          this.close();\n          reject(new Error(msg.data));\n          break;\n        // TODO(Kagami): Error handling.\n        case \"error\":\n        case \"internal-error\":\n          this.close();\n          console.error(\"Worker error:\", msg.data);\n          if (this.reject) this.reject(msg.data);\n          break;\n        case \"stop\":\n          this.blob = msg.data;\n          this.blobURL = URL.createObjectURL(msg.data);\n          if (this.onStop) this.onStop();\n          if (this.resolve) this.resolve(this.blob);\n          break;\n        }\n      }\n    });\n  }\n\n  init() {\n    return this.initAudio().then(this.initWorker.bind(this));\n  }\n\n  startRecording() {\n    if (!this.stream) throw new Error(\"missing audio initialization\");\n    if (!this.worker) throw new Error(\"missing worker initialization\");\n    this.blob = null;\n    if (this.blobURL) URL.revokeObjectURL(this.blobURL);\n    this.blobURL = null;\n    this.resolve = null;\n    this.reject = null;\n    this.worker.postMessage({type: \"start\", data: this.audioCtx.sampleRate});\n    this.encNode.onaudioprocess = (e) => {\n      const samples = e.inputBuffer.getChannelData(0);\n      this.worker.postMessage({type: \"data\", data: samples});\n    };\n    this.encNode.connect(this.audioCtx.destination);\n  }\n\n  stopRecording() {\n    if (!this.stream) throw new Error(\"missing audio initialization\");\n    if (!this.worker) throw new Error(\"missing worker initialization\");\n    this.encNode.disconnect();\n    this.encNode.onaudioprocess = null;\n    this.stopTracks();\n    this.audioCtx.close();\n    this.worker.postMessage({type: \"stop\", data: null});\n    return new Promise((resolve, reject) => {\n      this.resolve = resolve;\n      this.reject = reject;\n    });\n  }\n\n  stopTracks() {\n    // Might be missed in Safari and old FF/Chrome per MDN.\n    if (this.stream.getTracks) {\n      // Hide browser's recording indicator.\n      this.stream.getTracks().forEach((track) => track.stop());\n    }\n  }\n}\n\nexport class Form {\n  constructor(opts = {}, resolve, reject) {\n    this.recorder = new Recorder(opts, this.onStop.bind(this));\n    this.resolve = resolve;\n    this.reject = reject;\n    this.backdrop = null;\n    this.popup = null;\n    this.recordBtn = null;\n    this.stopBtn = null;\n    this.timer = null;\n    this.audio = null;\n    this.saveBtn = null;\n    this.tid = 0;\n    this.start = 0;\n    Object.seal(this);\n\n    this.recorder.initAudio()\n      .then(() => this.drawInit())\n      .then(() => this.recorder.initWorker())\n      .then(() => this.drawAll())\n      .catch((err) => this.drawError(err));\n  }\n\n  drawInit() {\n    if (this.backdrop) return;\n    const backdrop = this.backdrop = document.createElement(\"div\");\n    backdrop.className = \"vmsg-backdrop\";\n    backdrop.addEventListener(\"click\", () => this.close(null));\n\n    const popup = this.popup = document.createElement(\"div\");\n    popup.className = \"vmsg-popup\";\n    popup.addEventListener(\"click\", (e) => e.stopPropagation());\n\n    const progress = document.createElement(\"div\");\n    progress.className = \"vmsg-progress\";\n    for (let i = 0; i < 3; i++) {\n      const progressDot = document.createElement(\"div\");\n      progressDot.className = \"vmsg-progress-dot\";\n      progress.appendChild(progressDot);\n    }\n    popup.appendChild(progress);\n\n    backdrop.appendChild(popup);\n    document.body.appendChild(backdrop);\n  }\n\n  drawTime(msecs) {\n    const secs = Math.round(msecs / 1000);\n    this.timer.textContent = pad2(secs / 60) + \":\" + pad2(secs % 60);\n  }\n\n  drawAll() {\n    this.drawInit();\n    this.clearAll();\n\n    const recordRow = document.createElement(\"div\");\n    recordRow.className = \"vmsg-record-row\";\n    this.popup.appendChild(recordRow);\n\n    const recordBtn = this.recordBtn = document.createElement(\"button\");\n    recordBtn.className = \"vmsg-button vmsg-record-button\";\n    recordBtn.textContent = \"●\";\n    recordBtn.title = \"Start Recording\";\n    recordBtn.addEventListener(\"click\", () => this.startRecording());\n    recordRow.appendChild(recordBtn);\n\n    const stopBtn = this.stopBtn = document.createElement(\"button\");\n    stopBtn.className = \"vmsg-button vmsg-stop-button\";\n    stopBtn.style.display = \"none\";\n    stopBtn.textContent = \"■\";\n    stopBtn.title = \"Stop Recording\";\n    stopBtn.addEventListener(\"click\", () => this.stopRecording());\n    recordRow.appendChild(stopBtn);\n\n    const audio = this.audio = new Audio();\n    audio.autoplay = true;\n\n    const timer = this.timer = document.createElement(\"span\");\n    timer.className = \"vmsg-timer\";\n    timer.title = \"Preview Recording\";\n    timer.addEventListener(\"click\", () => {\n      if (audio.paused) {\n        if (this.recorder.blobURL) {\n          audio.src = this.recorder.blobURL;\n        }\n      } else {\n        audio.pause();\n      }\n    });\n    this.drawTime(0);\n    recordRow.appendChild(timer);\n\n    const saveBtn = this.saveBtn = document.createElement(\"button\");\n    saveBtn.className = \"vmsg-button vmsg-save-button\";\n    saveBtn.textContent = \"✓\";\n    saveBtn.title = \"Save Recording\";\n    saveBtn.disabled = true;\n    saveBtn.addEventListener(\"click\", () => this.close(this.recorder.blob));\n    recordRow.appendChild(saveBtn);\n\n    const gainWrapper = document.createElement(\"div\");\n    gainWrapper.className = \"vmsg-slider-wrapper vmsg-gain-slider-wrapper\";\n    const gainSlider = document.createElement(\"input\");\n    gainSlider.className = \"vmsg-slider vmsg-gain-slider\";\n    gainSlider.setAttribute(\"type\", \"range\");\n    gainSlider.min = 0;\n    gainSlider.max = 2;\n    gainSlider.step = 0.2;\n    gainSlider.value = 1;\n    gainSlider.onchange = () => {\n      const gain = +gainSlider.value;\n      this.recorder.gainNode.gain.value = gain;\n    };\n    gainWrapper.appendChild(gainSlider);\n    this.popup.appendChild(gainWrapper);\n\n    const pitchWrapper = document.createElement(\"div\");\n    pitchWrapper.className = \"vmsg-slider-wrapper vmsg-pitch-slider-wrapper\";\n    const pitchSlider = document.createElement(\"input\");\n    pitchSlider.className = \"vmsg-slider vmsg-pitch-slider\";\n    pitchSlider.setAttribute(\"type\", \"range\");\n    pitchSlider.min = -1;\n    pitchSlider.max = 1;\n    pitchSlider.step = 0.2;\n    pitchSlider.value = this.recorder.pitch;\n    pitchSlider.onchange = () => {\n      const pitch = +pitchSlider.value;\n      this.recorder.pitchFX.setPitchOffset(pitch);\n      this.recorder.gainNode.disconnect();\n      this.recorder.gainNode.connect(\n        pitch === 0 ? this.recorder.encNode : this.recorder.pitchFX.input\n      );\n    };\n    pitchWrapper.appendChild(pitchSlider);\n    this.popup.appendChild(pitchWrapper);\n    recordBtn.focus();\n  }\n\n  drawError(err) {\n    console.error(err);\n    this.drawInit();\n    this.clearAll();\n    const error = document.createElement(\"div\");\n    error.className = \"vmsg-error\";\n    error.textContent = err.toString();\n    this.popup.appendChild(error);\n  }\n\n  clearAll() {\n    if (!this.popup) return;\n    this.popup.innerHTML = \"\";\n  }\n\n  close(blob) {\n    if (this.audio) this.audio.pause();\n    if (this.tid) clearTimeout(this.tid);\n    this.recorder.close();\n    this.backdrop.remove();\n    if (blob) {\n      this.resolve(blob);\n    } else {\n      this.reject(new Error(\"No record made\"));\n    }\n  }\n\n  onStop() {\n    this.recordBtn.style.display = \"\";\n    this.stopBtn.style.display = \"none\";\n    this.stopBtn.disabled = false;\n    this.saveBtn.disabled = false;\n  }\n\n  startRecording() {\n    this.audio.pause();\n    this.start = Date.now();\n    this.updateTime();\n    this.recordBtn.style.display = \"none\";\n    this.stopBtn.style.display = \"\";\n    this.saveBtn.disabled = true;\n    this.stopBtn.focus();\n    this.recorder.startRecording();\n  }\n\n  stopRecording() {\n    clearTimeout(this.tid);\n    this.tid = 0;\n    this.stopBtn.disabled = true;\n    this.recordBtn.focus();\n    this.recorder.stopRecording();\n  }\n\n  updateTime() {\n    // NOTE(Kagami): We can do this in `onaudioprocess` but that would\n    // run too often and create unnecessary DOM updates.\n    this.drawTime(Date.now() - this.start);\n    this.tid = setTimeout(() => this.updateTime(), 300);\n  }\n}\n\nlet shown = false;\n\n/**\n * Record a new voice message.\n *\n * @param {Object=} opts - Options\n * @param {string=} opts.wasmURL - URL of the module\n *                                 (\"/static/js/vmsg.wasm\" by default)\n * @param {string=} opts.shimURL - URL of the WebAssembly polyfill\n *                                 (\"/static/js/wasm-polyfill.js\" by default)\n * @param {number=} opts.pitch - Initial pitch shift ([-1, 1], 0 by default)\n * @return {Promise.<Blob>} A promise that contains recorded blob when fulfilled.\n */\nexport function record(opts) {\n  return new Promise((resolve, reject) => {\n    if (shown) throw new Error(\"Record form is already opened\");\n    shown = true;\n    new Form(opts, resolve, reject);\n  // Use `.finally` once it's available in Safari and Edge.\n  }).then(result => {\n    shown = false;\n    return result;\n  }, err => {\n    shown = false;\n    throw err;\n  });\n}\n\n/**\n * All available public items.\n */\nexport default { Recorder, Form, record };\n\n// Borrowed from and slightly modified:\n// https://github.com/cwilso/Audio-Input-Effects/blob/master/js/jungle.js\n\n// Copyright 2012, Google Inc.\n// All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or without\n// modification, are permitted provided that the following conditions are\n// met:\n//\n//     * Redistributions of source code must retain the above copyright\n// notice, this list of conditions and the following disclaimer.\n//     * Redistributions in binary form must reproduce the above\n// copyright notice, this list of conditions and the following disclaimer\n// in the documentation and/or other materials provided with the\n// distribution.\n//     * Neither the name of Google Inc. nor the names of its\n// contributors may be used to endorse or promote products derived from\n// this software without specific prior written permission.\n//\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n// \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n// LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n// A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n// OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n// SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n// LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n// DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n// THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n\nconst delayTime = 0.100;\nconst fadeTime = 0.050;\nconst bufferTime = 0.100;\n\nfunction createFadeBuffer(context, activeTime, fadeTime) {\n  var length1 = activeTime * context.sampleRate;\n  var length2 = (activeTime - 2*fadeTime) * context.sampleRate;\n  var length = length1 + length2;\n  var buffer = context.createBuffer(1, length, context.sampleRate);\n  var p = buffer.getChannelData(0);\n\n  var fadeLength = fadeTime * context.sampleRate;\n\n  var fadeIndex1 = fadeLength;\n  var fadeIndex2 = length1 - fadeLength;\n\n  // 1st part of cycle\n  for (var i = 0; i < length1; ++i) {\n    var value;\n\n    if (i < fadeIndex1) {\n        value = Math.sqrt(i / fadeLength);\n    } else if (i >= fadeIndex2) {\n        value = Math.sqrt(1 - (i - fadeIndex2) / fadeLength);\n    } else {\n        value = 1;\n    }\n\n    p[i] = value;\n  }\n\n  // 2nd part\n  for (var i = length1; i < length; ++i) {\n    p[i] = 0;\n  }\n\n  return buffer;\n}\n\nfunction createDelayTimeBuffer(context, activeTime, fadeTime, shiftUp) {\n  var length1 = activeTime * context.sampleRate;\n  var length2 = (activeTime - 2*fadeTime) * context.sampleRate;\n  var length = length1 + length2;\n  var buffer = context.createBuffer(1, length, context.sampleRate);\n  var p = buffer.getChannelData(0);\n\n  // 1st part of cycle\n  for (var i = 0; i < length1; ++i) {\n    if (shiftUp)\n      // This line does shift-up transpose\n      p[i] = (length1-i)/length;\n    else\n      // This line does shift-down transpose\n      p[i] = i / length1;\n  }\n\n  // 2nd part\n  for (var i = length1; i < length; ++i) {\n    p[i] = 0;\n  }\n\n  return buffer;\n}\n\nfunction Jungle(context) {\n  this.context = context;\n  // Create nodes for the input and output of this \"module\".\n  var input = (context.createGain || context.createGainNode).call(context);\n  var output = (context.createGain || context.createGainNode).call(context);\n  this.input = input;\n  this.output = output;\n\n  // Delay modulation.\n  var mod1 = context.createBufferSource();\n  var mod2 = context.createBufferSource();\n  var mod3 = context.createBufferSource();\n  var mod4 = context.createBufferSource();\n  this.shiftDownBuffer = createDelayTimeBuffer(context, bufferTime, fadeTime, false);\n  this.shiftUpBuffer = createDelayTimeBuffer(context, bufferTime, fadeTime, true);\n  mod1.buffer = this.shiftDownBuffer;\n  mod2.buffer = this.shiftDownBuffer;\n  mod3.buffer = this.shiftUpBuffer;\n  mod4.buffer = this.shiftUpBuffer;\n  mod1.loop = true;\n  mod2.loop = true;\n  mod3.loop = true;\n  mod4.loop = true;\n\n  // for switching between oct-up and oct-down\n  var mod1Gain = (context.createGain || context.createGainNode).call(context);\n  var mod2Gain = (context.createGain || context.createGainNode).call(context);\n  var mod3Gain = (context.createGain || context.createGainNode).call(context);\n  mod3Gain.gain.value = 0;\n  var mod4Gain = (context.createGain || context.createGainNode).call(context);\n  mod4Gain.gain.value = 0;\n\n  mod1.connect(mod1Gain);\n  mod2.connect(mod2Gain);\n  mod3.connect(mod3Gain);\n  mod4.connect(mod4Gain);\n\n  // Delay amount for changing pitch.\n  var modGain1 = (context.createGain || context.createGainNode).call(context);\n  var modGain2 = (context.createGain || context.createGainNode).call(context);\n\n  var delay1 = (context.createDelay || context.createDelayNode).call(context);\n  var delay2 = (context.createDelay || context.createDelayNode).call(context);\n  mod1Gain.connect(modGain1);\n  mod2Gain.connect(modGain2);\n  mod3Gain.connect(modGain1);\n  mod4Gain.connect(modGain2);\n  modGain1.connect(delay1.delayTime);\n  modGain2.connect(delay2.delayTime);\n\n  // Crossfading.\n  var fade1 = context.createBufferSource();\n  var fade2 = context.createBufferSource();\n  var fadeBuffer = createFadeBuffer(context, bufferTime, fadeTime);\n  fade1.buffer = fadeBuffer\n  fade2.buffer = fadeBuffer;\n  fade1.loop = true;\n  fade2.loop = true;\n\n  var mix1 = (context.createGain || context.createGainNode).call(context);\n  var mix2 = (context.createGain || context.createGainNode).call(context);\n  mix1.gain.value = 0;\n  mix2.gain.value = 0;\n\n  fade1.connect(mix1.gain);\n  fade2.connect(mix2.gain);\n\n  // Connect processing graph.\n  input.connect(delay1);\n  input.connect(delay2);\n  delay1.connect(mix1);\n  delay2.connect(mix2);\n  mix1.connect(output);\n  mix2.connect(output);\n\n  // Start\n  var t = context.currentTime + 0.050;\n  var t2 = t + bufferTime - fadeTime;\n  mod1.start(t);\n  mod2.start(t2);\n  mod3.start(t);\n  mod4.start(t2);\n  fade1.start(t);\n  fade2.start(t2);\n\n  this.mod1 = mod1;\n  this.mod2 = mod2;\n  this.mod1Gain = mod1Gain;\n  this.mod2Gain = mod2Gain;\n  this.mod3Gain = mod3Gain;\n  this.mod4Gain = mod4Gain;\n  this.modGain1 = modGain1;\n  this.modGain2 = modGain2;\n  this.fade1 = fade1;\n  this.fade2 = fade2;\n  this.mix1 = mix1;\n  this.mix2 = mix2;\n  this.delay1 = delay1;\n  this.delay2 = delay2;\n\n  this.setDelay(delayTime);\n}\n\nJungle.prototype.setDelay = function(delayTime) {\n  this.modGain1.gain.setTargetAtTime(0.5*delayTime, 0, 0.010);\n  this.modGain2.gain.setTargetAtTime(0.5*delayTime, 0, 0.010);\n};\n\nJungle.prototype.setPitchOffset = function(mult) {\n  if (mult>0) { // pitch up\n    this.mod1Gain.gain.value = 0;\n    this.mod2Gain.gain.value = 0;\n    this.mod3Gain.gain.value = 1;\n    this.mod4Gain.gain.value = 1;\n  } else { // pitch down\n    this.mod1Gain.gain.value = 1;\n    this.mod2Gain.gain.value = 1;\n    this.mod3Gain.gain.value = 0;\n    this.mod4Gain.gain.value = 0;\n  }\n  this.setDelay(delayTime*Math.abs(mult));\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}